define(["backbone","com/ericmatthys/Config","com/ericmatthys/models/AppModel"],function(a,b,c){var d,e=a.View.extend({idName:b.getVideoID(),bufferInterval:null,events:{loadedmetadata:"onLoadedMetadata",timeupdate:"onTimeUpdate",ended:"onEnded"},initialize:function(){_.bindAll(this,"onBufferUpdate")},onLoadedMetadata:function(){var a=this.el.duration,b=c.video.secondsToHms(a),d=this.el.currentTime,e=c.video.secondsToHms(d);c.video.set({duration:a,formattedDuration:b,currentTime:d,formattedTime:e,volume:this.el.volume,playbackRate:this.el.playbackRate}),typeof this.el.buffered!="undefined"&&(this.onBufferUpdate(),bufferInterval=setInterval(this.onBufferUpdate,1e3))},onBufferUpdate:function(){var a=this.el.buffered;a.length>0&&c.video.set({startBuffer:a.start(0),endBuffer:a.end(0)})},onTimeUpdate:function(){var a=this.el.currentTime,b=c.video.secondsToHms(a);c.video.set({currentTime:a}),c.video.set({formattedTime:b})},onEnded:function(){c.video.set({paused:!0}),this.el.pause()}});return{viewConstructor:e,initialize:function(){return d=new e,d.setElement($("#"+d.idName)),d.el.duration>0&&(console.log("metadata already loaded"),d.onLoadedMetadata()),d},playPause:function(){var a=d.el;a.paused===!0?(a.ended===!0&&(d.el.currentTime=0),c.video.set({paused:!1}),a.play()):(c.video.set({paused:!0}),a.pause())},seek:function(a){d.el.currentTime=a},setVolume:function(a){c.video.set({volume:a}),d.el.volume=a},setPlaybackRate:function(a){c.video.set({playbackRate:a}),d.el.playbackRate=a},supportsPlaybackRate:function(){return typeof d.el.playbackRate!="undefined"}}})