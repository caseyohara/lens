define(["backbone","com/ericmatthys/models/PlayerModel"],function(a,b){var c="emp-player-wrapper",d="emp-video-fullscreen",e=a.View.extend({el:"#"+b.config.get("videoID"),wrapper:null,$wrapper:null,events:{loadedmetadata:"onLoadedMetadata",progress:"onProgress",canplaythrough:"onCanPlayThrough",timeupdate:"onTimeUpdate",ended:"onEnded"},initialize:function(){_.bindAll(this,"onFullscreenChange");if(typeof this.el=="undefined")throw"A video tag with the id, "+b.config.get("videoID")+", was not found.";var a=this.$el.width();b.video.set({width:a});var d=b.config.get("videoID")+"-wrapper",e=this.make("div",{id:d,"class":c});this.$el.wrap(e),this.$wrapper=$("#"+d),this.wrapper=this.$wrapper.get(0),this.$wrapper.css("width",a),this.$wrapper.bind("webkitfullscreenchange",this.onFullscreenChange),this.$wrapper.bind("mozfullscreenchange",this.onFullscreenChange),this.el.muted===!0&&(this.setVolume(0),this.el.muted=!1),this.el.duration>0&&this.onLoadedMetadata()},playPause:function(){var a=this.el;a.paused===!0?(a.ended===!0&&(a.currentTime=0),b.video.set({paused:!1}),a.play()):(b.video.set({paused:!0}),a.pause())},sync:function(){var a=this.el,c=b.video.get("paused");c!==a.paused&&this.playPause()},seek:function(a){this.el.currentTime=a},setVolume:function(a){b.video.set({volume:a}),this.el.volume=a},setPlaybackRate:function(a){b.video.set({playbackRate:a}),this.el.playbackRate=a},enterFullscreen:function(){this.$wrapper.css("width","100%"),this.$el.addClass(d),this.wrapper.requestFullScreen?this.wrapper.requestFullScreen():this.wrapper.requestFullscreen?this.wrapper.requestFullscreen():this.wrapper.mozRequestFullScreen?this.wrapper.mozRequestFullScreen():this.wrapper.webkitRequestFullScreen&&this.wrapper.webkitRequestFullScreen()},exitFullscreen:function(){typeof document.cancelFullScreen=="function"?document.cancelFullScreen():typeof document.exitFullscreen=="function"?document.exitFullscreen():typeof document.mozCancelFullScreen=="function"?document.mozCancelFullScreen():typeof document.webkitCancelFullScreen=="function"&&document.webkitCancelFullScreen()},supportsFullscreen:function(){return typeof document.webkitCancelFullScreen=="function"||typeof document.mozCancelFullScreen=="function"||typeof document.cancelFullScreen=="function"||typeof document.exitFullscreen=="function"?!0:!1},supportsPlaybackRate:function(){return typeof this.el.playbackRate!="undefined"},onLoadedMetadata:function(){var a=this.el.duration,c=b.video.secondsToHms(a),d=this.el.currentTime,e=b.video.secondsToHms(d);b.video.set({duration:a,formattedDuration:c,currentTime:d,formattedTime:e,volume:this.el.volume,playbackRate:this.el.playbackRate})},onProgress:function(){if(typeof this.el.buffered!="undefined"){var a=this.el.buffered;if(a.length>0){var c=a.start(0),d=a.end(0);b.video.set({startBuffer:c,endBuffer:d})}}},onCanPlayThrough:function(){this.el.autoplay===!0&&(b.video.set({paused:!1}),this.el.play())},onTimeUpdate:function(){var a=this.el.currentTime,c=b.video.secondsToHms(a);b.video.set({currentTime:a}),b.video.set({formattedTime:c})},onEnded:function(){b.video.set({paused:!0}),this.el.pause()},onFullscreenChange:function(){b.video.isFullscreen()===!0?(b.video.set({fullscreen:!0}),this.$el.addClass(d)):(b.video.set({fullscreen:!1}),this.$el.removeClass(d),this.$wrapper.css("width",b.video.get("width")))}});return e})