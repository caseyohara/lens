define(["backbone","com/ericmatthys/Config","com/ericmatthys/models/AppModel","com/ericmatthys/views/Container","text!templates/controls.html"],function(a,b,c,d,e){var f="emp-play-pause",g="emp-pause",h="emp-current-time",i="emp-seek-bar",j="emp-progress-bar",k="emp-progress-thumb",l="emp-volume-button",m="emp-volume-button-low",n="emp-volume-button-off",o="emp-volume-slider",p="emp-volume-bar",q="emp-volume-thumb",r,s=a.View.extend({className:"emp-controls",model:c.video,muted:!1,mutedVolume:0,events:{"click .emp-play-pause":"onPlayPauseClick","click .emp-volume-button":"onVolumeButtonClick","mousedown .emp-seek-bar":"onSeekBarMouseDown","mousedown .emp-volume-slider":"onVolumeSliderMouseDown"},initialize:function(){_.bindAll(this,"onSeekBarMouseMove"),_.bindAll(this,"onSeekBarMouseUp"),_.bindAll(this,"onVolumeSliderMouseMove"),_.bindAll(this,"onVolumeSliderMouseUp"),_.bindAll(this,"onPausedChange"),_.bindAll(this,"onCurrentTimeChange"),_.bindAll(this,"onVolumeChange"),this.model.bind("change:paused",this.onPausedChange),this.model.bind("change:currentTime",this.onCurrentTimeChange),this.model.bind("change:volume",this.onVolumeChange)},render:function(){return this.$el.html(_.template(e,c.video.toJSON())),this},seek:function(a){var b=$(".emp-seek-bar"),e=a-b.offset().left,f=e/b.width(),g=f*c.video.get("duration");d.seek(g)},setVolume:function(a){var b=$(".emp-volume-slider"),c=a-b.offset().left,e=c/b.width();e>1?e=1:e<0&&(e=0),d.setVolume(e)},onPlayPauseClick:function(a){a.preventDefault(),d.playPause()},onVolumeButtonClick:function(a){a.preventDefault(),this.muted===!0?(this.mutedVolume>0?d.setVolume(this.mutedVolume):d.setVolume(1),this.muted=!1,this.mutedVolume=0):(this.muted=!0,this.mutedVolume=c.video.get("volume"),d.setVolume(0))},onSeekBarMouseDown:function(a){a.preventDefault(),$(document).bind("mousemove",this.onSeekBarMouseMove),$(document).bind("mouseup",this.onSeekBarMouseUp),this.seek(a.pageX)},onSeekBarMouseMove:function(a){a.preventDefault(),this.seek(a.pageX)},onSeekBarMouseUp:function(a){a.preventDefault(),$(document).unbind("mousemove",this.onSeekBarMouseMove),$(document).unbind("mouseup",this.onSeekBarMouseUp),this.seek(a.pageX)},onVolumeSliderMouseDown:function(a){a.preventDefault(),$(document).bind("mousemove",this.onVolumeSliderMouseMove),$(document).bind("mouseup",this.onVolumeSliderMouseUp),this.setVolume(a.pageX)},onVolumeSliderMouseMove:function(a){a.preventDefault(),this.setVolume(a.pageX)},onVolumeSliderMouseUp:function(a){a.preventDefault(),$(document).unbind("mousemove",this.onVolumeSliderMouseMove),$(document).unbind("mouseup",this.onVolumeSliderMouseUp),this.setVolume(a.pageX)},onCurrentTimeChange:function(){var a=$("."+i).width(),b=c.video.get("currentTime")/c.video.get("duration"),d=b*a;d<4?d=4:d+4>a&&(d=a-4),$("."+j).width(d),$("."+k).css("left",d-4),$("."+h).html(c.video.get("formattedTime"))},onPausedChange:function(){var a=c.video.get("paused");a?$("."+f).removeClass(g):$("."+f).addClass(g)},onVolumeChange:function(){var a=c.video.get("volume"),b=$("."+o).width(),d=a*b;d<4?d=4:d+4>b&&(d=b-4),$("."+p).width(d),$("."+q).css("left",d-4),a>.5?(this.muted=!1,$("."+l).removeClass(m),$("."+l).removeClass(n)):a<.5&&a>0?(this.muted=!1,$("."+l).addClass(m),$("."+l).removeClass(n)):(this.muted=!0,$("."+l).addClass(n),$("."+l).removeClass(m))}});return{viewConstructor:s,initialize:function(){r=new s;var a=$("#"+b.getVideoID()),c=r.make("div",{"class":r.className});return a.after(c),$("."+r.className).width(a.width()),r.setElement(c),r.render(),r}}})