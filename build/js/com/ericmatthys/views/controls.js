define(["backbone","com/ericmatthys/Config","com/ericmatthys/models/AppModel","com/ericmatthys/views/Container","com/ericmatthys/views/SeekBar","text!templates/controls.html"],function(a,b,c,d,e,f){var g="emp-play-pause-button",h="emp-pause-button",i="emp-seek-bar",j="emp-current-time",k="emp-duration",l="emp-volume-container",m="emp-volume-button",n="emp-volume-button-low",o="emp-volume-button-off",p="emp-volume-slider",q="emp-volume-bar",r="emp-volume-thumb",s="emp-playback-rate-container",t="emp-playback-rate-slider",u="emp-playback-rate-bar",v="emp-playback-rate-thumb",w="emp-divider-playback-rate",x="emp-fullscreen-wrapper",y="emp-video-fullscreen",z="emp-controls-fullscreen",A="emp-fullscreen-button",B="emp-divider-fullscreen",C,D,E=a.View.extend({className:"emp-controls",model:c.video,muted:!1,mutedVolume:0,controlsWidth:0,volumeCollapsedWidth:40,volumeExpandedWidth:150,playbackRateCollapsedWidth:40,playbackRateExpandedWidth:150,events:{"click .emp-play-pause-button":"onPlayPauseClick","click .emp-volume-button":"onVolumeButtonClick","click .emp-fullscreen-button":"onFullscreenButtonClick","mouseover .emp-volume-container":"onVolumeContainerMouseOver","mouseout .emp-volume-container":"onVolumeContainerMouseOut","mouseover .emp-playback-rate-container":"onPlaybackRateContainerMouseOver","mouseout .emp-playback-rate-container":"onPlaybackRateContainerMouseOut","mousedown .emp-volume-slider":"onVolumeSliderMouseDown","mousedown .emp-playback-rate-slider":"onPlaybackRateSliderMouseDown"},initialize:function(){_.bindAll(this,"onVolumeSliderMouseMove"),_.bindAll(this,"onVolumeSliderMouseUp"),_.bindAll(this,"onPlaybackRateSliderMouseMove"),_.bindAll(this,"onPlaybackRateSliderMouseUp"),_.bindAll(this,"onDurationChange"),_.bindAll(this,"onPausedChange"),_.bindAll(this,"onCurrentTimeChange"),_.bindAll(this,"onVolumeChange"),_.bindAll(this,"onPlaybackRateChange"),this.model.bind("change:formattedDuration",this.onDurationChange),this.model.bind("change:paused",this.onPausedChange),this.model.bind("change:formattedTime",this.onCurrentTimeChange),this.model.bind("change:volume",this.onVolumeChange),this.model.bind("change:playbackRate",this.onPlaybackRateChange),d.supportsFullscreen()===!0&&(_.bindAll(this,"onFullscreenChange"),$(document).bind("webkitfullscreenchange",this.onFullscreenChange),$(document).bind("mozfullscreenchange",this.onFullscreenChange))},render:function(){return this.$el.html(_.template(f,c.video.toJSON())),this.onVolumeChange(),this.onPlaybackRateChange(),this},setVolume:function(a){var b=$("."+p),c=a-b.offset().left,e=c/b.width();e>1?e=1:e<0&&(e=0),d.setVolume(e)},setPlaybackRate:function(a){var b=$("."+t),c=a-b.offset().left,e=c/b.width();e>1?e=1:e<.1&&(e=.1);var f=e*3;d.setPlaybackRate(f)},onPlayPauseClick:function(a){a.preventDefault(),d.playPause()},onVolumeButtonClick:function(a){a.preventDefault(),this.muted===!0?(this.mutedVolume>0?d.setVolume(this.mutedVolume):d.setVolume(1),this.muted=!1,this.mutedVolume=0):(this.muted=!0,this.mutedVolume=c.video.get("volume"),d.setVolume(0))},onFullscreenButtonClick:function(a){a.preventDefault();var c=$("#"+b.getVideoID());if(document.webkitIsFullScreen===!0||document.mozFullScreen===!0||document.fullScreen===!0)typeof document.cancelFullScreen=="function"?document.cancelFullScreen():typeof document.exitFullscreen=="function"?document.exitFullscreen():typeof document.mozCancelFullScreen=="function"?document.mozCancelFullScreen():typeof document.webkitCancelFullScreen=="function"&&document.webkitCancelFullScreen();else{this.$el.wrap(this.make("div",{"class":x}));var d=$("."+x),e=d.get(0);d.prepend(c),e.requestFullScreen?e.requestFullScreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen()}},onFullscreenChange:function(){var a=$("#"+b.getVideoID());document.webkitIsFullScreen===!0||document.mozFullScreen===!0||document.fullScreen===!0?(this.$el.addClass(z),this.$el.css("width","100%"),a.addClass(y)):(this.$el.unwrap(),this.$el.removeClass(z),this.$el.css("width",this.controlsWidth),a.removeClass(y)),D.render(),d.sync()},onVolumeContainerMouseOver:function(a){$("."+l).animate({width:this.volumeExpandedWidth})},onVolumeContainerMouseOut:function(a){$("."+l).animate({width:this.volumeCollapsedWidth})},onPlaybackRateContainerMouseOver:function(a){$("."+s).animate({width:this.playbackRateExpandedWidth})},onPlaybackRateContainerMouseOut:function(a){$("."+s).animate({width:this.playbackRateCollapsedWidth})},onVolumeSliderMouseDown:function(a){a.preventDefault(),$(document).bind("mousemove",this.onVolumeSliderMouseMove),$(document).bind("mouseup",this.onVolumeSliderMouseUp),this.setVolume(a.pageX)},onVolumeSliderMouseMove:function(a){a.preventDefault(),this.setVolume(a.pageX)},onVolumeSliderMouseUp:function(a){a.preventDefault(),$(document).unbind("mousemove",this.onVolumeSliderMouseMove),$(document).unbind("mouseup",this.onVolumeSliderMouseUp),this.setVolume(a.pageX)},onPlaybackRateSliderMouseDown:function(a){a.preventDefault(),$(document).bind("mousemove",this.onPlaybackRateSliderMouseMove),$(document).bind("mouseup",this.onPlaybackRateSliderMouseUp),this.setPlaybackRate(a.pageX)},onPlaybackRateSliderMouseMove:function(a){a.preventDefault(),this.setPlaybackRate(a.pageX)},onPlaybackRateSliderMouseUp:function(a){a.preventDefault(),$(document).unbind("mousemove",this.onPlaybackRateSliderMouseMove),$(document).unbind("mouseup",this.onPlaybackRateSliderMouseUp),d.setPlaybackRate(1)},onPausedChange:function(){var a=c.video.get("paused");a?$("."+g).removeClass(h):$("."+g).addClass(h)},onCurrentTimeChange:function(){$("."+j).html(c.video.get("formattedTime"))},onDurationChange:function(){$("."+k).html(c.video.get("formattedDuration"))},onVolumeChange:function(){var a=$("."+m),b=c.video.get("volume"),d=$("."+p).width(),e=b*d;e<4?e=4:e+4>d&&(e=d-4),$("."+q).width(e),$("."+r).css("left",e-4),b>.5?(this.muted=!1,a.removeClass(n),a.removeClass(o)):b<.5&&b>0?(this.muted=!1,a.addClass(n),a.removeClass(o)):(this.muted=!0,a.addClass(o),a.removeClass(n))},onPlaybackRateChange:function(){var a=c.video.get("playbackRate"),b=$("."+t).width(),d=a/3*b;d<4?d=4:d+4>b&&(d=b-4),$("."+u).width(d),$("."+v).css("left",d-4)}});return{viewConstructor:E,initialize:function(){C=new E;var a=$("#"+b.getVideoID()),c=C.make("div",{"class":C.className});return a.after(c),C.controlsWidth=a.width(),$("."+C.className).width(C.controlsWidth),C.setElement(c),C.render(),D=new e,D.setElement($("."+i)),D.render(),d.supportsPlaybackRate()===!1&&($("."+s).css("display","none"),$("."+w).css("display","none")),d.supportsFullscreen()===!1&&($("."+A).css("display","none"),$("."+B).css("display","none")),C}}})