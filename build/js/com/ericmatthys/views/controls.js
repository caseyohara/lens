define(["backbone","com/ericmatthys/Config","com/ericmatthys/models/AppModel","com/ericmatthys/views/Container","text!templates/controls.html"],function(a,b,c,d,e){var f="emp-play-pause-button",g="emp-pause-button",h="emp-current-time",i="emp-duration",j="emp-seek-bar",k="emp-buffer-bar",l="emp-progress-bar",m="emp-progress-thumb",n="emp-volume-container",o="emp-volume-button",p="emp-volume-button-low",q="emp-volume-button-off",r="emp-volume-slider",s="emp-volume-bar",t="emp-volume-thumb",u="emp-playback-rate-container",v="emp-playback-rate-slider",w="emp-playback-rate-bar",x="emp-playback-rate-thumb",y,z=a.View.extend({className:"emp-controls",model:c.video,muted:!1,mutedVolume:0,events:{"click .emp-play-pause-button":"onPlayPauseClick","click .emp-volume-button":"onVolumeButtonClick","mouseover .emp-volume-container":"onVolumeContainerMouseOver","mouseout .emp-volume-container":"onVolumeContainerMouseOut","mouseover .emp-playback-rate-container":"onPlaybackRateContainerMouseOver","mouseout .emp-playback-rate-container":"onPlaybackRateContainerMouseOut","mousedown .emp-seek-bar":"onSeekBarMouseDown","mousedown .emp-volume-slider":"onVolumeSliderMouseDown","mousedown .emp-playback-rate-slider":"onPlaybackRateSliderMouseDown"},initialize:function(){_.bindAll(this,"onSeekBarMouseMove"),_.bindAll(this,"onSeekBarMouseUp"),_.bindAll(this,"onVolumeSliderMouseMove"),_.bindAll(this,"onVolumeSliderMouseUp"),_.bindAll(this,"onPlaybackRateSliderMouseMove"),_.bindAll(this,"onPlaybackRateSliderMouseUp"),_.bindAll(this,"onDurationChange"),_.bindAll(this,"onPausedChange"),_.bindAll(this,"onCurrentTimeChange"),_.bindAll(this,"onVolumeChange"),_.bindAll(this,"onPlaybackRateChange"),_.bindAll(this,"onBufferChange"),this.model.bind("change:formattedDuration",this.onDurationChange),this.model.bind("change:paused",this.onPausedChange),this.model.bind("change:formattedTime",this.onCurrentTimeChange),this.model.bind("change:volume",this.onVolumeChange),this.model.bind("change:playbackRate",this.onPlaybackRateChange),this.model.bind("change:startBuffer",this.onBufferChange),this.model.bind("change:endBuffer",this.onBufferChange)},render:function(){return this.$el.html(_.template(e,c.video.toJSON())),this.onVolumeChange(),this.onPlaybackRateChange(),this},seek:function(a){var b=$("."+j),e=a-b.offset().left,f=e/b.width(),g=f*c.video.get("duration");d.seek(g)},setVolume:function(a){var b=$("."+r),c=a-b.offset().left,e=c/b.width();e>1?e=1:e<0&&(e=0),d.setVolume(e)},setPlaybackRate:function(a){var b=$("."+v),c=a-b.offset().left,e=c/b.width();e>1?e=1:e<.1&&(e=.1);var f=e*3;d.setPlaybackRate(f)},onPlayPauseClick:function(a){a.preventDefault(),d.playPause()},onVolumeButtonClick:function(a){a.preventDefault(),this.muted===!0?(this.mutedVolume>0?d.setVolume(this.mutedVolume):d.setVolume(1),this.muted=!1,this.mutedVolume=0):(this.muted=!0,this.mutedVolume=c.video.get("volume"),d.setVolume(0))},onVolumeContainerMouseOver:function(a){$("."+n).animate({width:150})},onVolumeContainerMouseOut:function(a){$("."+n).animate({width:40})},onPlaybackRateContainerMouseOver:function(a){$("."+u).animate({width:150})},onPlaybackRateContainerMouseOut:function(a){$("."+u).animate({width:40})},onSeekBarMouseDown:function(a){a.preventDefault(),$(document).bind("mousemove",this.onSeekBarMouseMove),$(document).bind("mouseup",this.onSeekBarMouseUp),this.seek(a.pageX)},onSeekBarMouseMove:function(a){a.preventDefault(),this.seek(a.pageX)},onSeekBarMouseUp:function(a){a.preventDefault(),$(document).unbind("mousemove",this.onSeekBarMouseMove),$(document).unbind("mouseup",this.onSeekBarMouseUp),this.seek(a.pageX)},onVolumeSliderMouseDown:function(a){a.preventDefault(),$(document).bind("mousemove",this.onVolumeSliderMouseMove),$(document).bind("mouseup",this.onVolumeSliderMouseUp),this.setVolume(a.pageX)},onVolumeSliderMouseMove:function(a){a.preventDefault(),this.setVolume(a.pageX)},onVolumeSliderMouseUp:function(a){a.preventDefault(),$(document).unbind("mousemove",this.onVolumeSliderMouseMove),$(document).unbind("mouseup",this.onVolumeSliderMouseUp),this.setVolume(a.pageX)},onPlaybackRateSliderMouseDown:function(a){a.preventDefault(),$(document).bind("mousemove",this.onPlaybackRateSliderMouseMove),$(document).bind("mouseup",this.onPlaybackRateSliderMouseUp),this.setPlaybackRate(a.pageX)},onPlaybackRateSliderMouseMove:function(a){a.preventDefault(),this.setPlaybackRate(a.pageX)},onPlaybackRateSliderMouseUp:function(a){a.preventDefault(),$(document).unbind("mousemove",this.onPlaybackRateSliderMouseMove),$(document).unbind("mouseup",this.onPlaybackRateSliderMouseUp),d.setPlaybackRate(1)},onPausedChange:function(){var a=c.video.get("paused");a?$("."+f).removeClass(g):$("."+f).addClass(g)},onCurrentTimeChange:function(){var a=$("."+j).width(),b=c.video.get("currentTime")/c.video.get("duration"),d=b*a;d<4?d=4:d+4>a&&(d=a-4),$("."+l).width(d),$("."+m).css("left",d-4),$("."+h).html(c.video.get("formattedTime"))},onDurationChange:function(){$("."+i).html(c.video.get("formattedDuration"))},onVolumeChange:function(){var a=c.video.get("volume"),b=$("."+r).width(),d=a*b;d<4?d=4:d+4>b&&(d=b-4),$("."+s).width(d),$("."+t).css("left",d-4),a>.5?(this.muted=!1,$("."+o).removeClass(p),$("."+o).removeClass(q)):a<.5&&a>0?(this.muted=!1,$("."+o).addClass(p),$("."+o).removeClass(q)):(this.muted=!0,$("."+o).addClass(q),$("."+o).removeClass(p))},onPlaybackRateChange:function(){var a=c.video.get("playbackRate"),b=$("."+v).width(),d=a/3*b;d<4?d=4:d+4>b&&(d=b-4),$("."+w).width(d),$("."+x).css("left",d-4)},onBufferChange:function(){var a=$("."+j).width(),b=c.video.get("duration"),d=c.video.get("startBuffer")/b,e=c.video.get("endBuffer")/b,f=d*a,g=e*a-f;$("."+k).css("left",f),$("."+k).width(g)}});return{viewConstructor:z,initialize:function(){y=new z;var a=$("#"+b.getVideoID()),c=y.make("div",{"class":y.className});return a.after(c),$("."+y.className).width(a.width()),y.setElement(c),y.render(),y}}})