define(["backbone","com/ericmatthys/models/PlayerModel","com/ericmatthys/views/SeekBar","text!templates/controls.html"],function(a,b,c,d){var e="emp-controls-fullscreen",f="emp-controls-collapsed",g="emp-play-pause-button",h="emp-pause-button",i="emp-current-time",j="emp-duration",k="emp-active-slider",l="emp-volume-container",m="emp-volume-button",n="emp-volume-button-low",o="emp-volume-button-off",p="emp-volume-slider",q="emp-volume-bar",r="emp-volume-thumb",s="emp-divider-volume",t="emp-playback-rate-container",u="emp-playback-rate-slider",v="emp-playback-rate-bar",w="emp-playback-rate-thumb",x="emp-divider-playback-rate",y="emp-fullscreen-button",z="emp-divider-fullscreen",A=a.View.extend({className:"emp-controls",model:b.video,seekBar:null,muted:!1,mutedVolume:0,showVolume:!1,showFullscreen:!1,showPlaybackRate:!1,hideControlsTimeout:null,events:{"click .emp-play-pause-button":"onPlayPauseClick","click .emp-volume-button":"onVolumeButtonClick","click .emp-fullscreen-button":"onFullscreenButtonClick","mousedown .emp-volume-slider":"onVolumeSliderMouseDown","mousedown .emp-playback-rate-slider":"onPlaybackRateSliderMouseDown"},initialize:function(a){this.showVolume=a.showVolume,this.showFullscreen=a.showFullscreen,this.showPlaybackRate=a.showPlaybackRate,_.bindAll(this,"onVolumeSliderMouseMove","onVolumeSliderMouseUp","onPlaybackRateSliderMouseMove","onPlaybackRateSliderMouseUp","onFullscreenMouseMove","onFullscreenShowControls","onFullscreenHideControls"),this.model.bind("change:formattedDuration",this.onDurationChange,this),this.model.bind("change:paused",this.onPausedChange,this),this.model.bind("change:formattedTime",this.onCurrentTimeChange,this),this.model.bind("change:volume",this.onVolumeChange,this),this.model.bind("change:playbackRate",this.onPlaybackRateChange,this),this.model.bind("change:fullscreen",this.onFullscreenChange,this),this.create(a.$video)},create:function(a){var b=this.make("div",{"class":this.className});a.after(b),this.setElement(b),this.render(),this.seekBar=new c,this.seekBar.render(),this.showVolume===!1&&($("."+l).css("display","none"),$("."+s).css("display","none")),this.showFullscreen===!1&&($("."+y).css("display","none"),$("."+z).css("display","none")),this.showPlaybackRate===!1&&($("."+t).css("display","none"),$("."+x).css("display","none"))},render:function(){return this.$el.html(_.template(d,b.video.toJSON())),this.onVolumeChange(),this.onPlaybackRateChange(),this},setVolume:function(a){var b=$("."+p),c=a-b.offset().left,d=c/b.width();d>1?d=1:d<0&&(d=0),this.trigger("setVolume",d)},setPlaybackRate:function(a){var b=$("."+u),c=a-b.offset().left,d=c/b.width();d>1?d=1:d<.033&&(d=.033);var e=d*3;this.trigger("setPlaybackRate",e)},onPlayPauseClick:function(a){a.preventDefault(),this.trigger("playPause")},onVolumeButtonClick:function(a){a.preventDefault(),this.muted===!0?(this.mutedVolume>0?this.trigger("setVolume",this.mutedVolume):this.trigger("setVolume",1),this.muted=!1,this.mutedVolume=0):(this.muted=!0,this.mutedVolume=b.video.get("volume"),this.trigger("setVolume",0))},onFullscreenButtonClick:function(a){a.preventDefault(),b.video.isFullscreen()===!0?(this.$el.removeClass(e),this.trigger("exitFullscreen")):(this.$el.addClass(e),this.trigger("enterFullscreen"))},onFullscreenChange:function(){b.video.isFullscreen()===!0?($(document).bind("mousemove",this.onFullscreenMouseMove),this.onFullscreenMouseMove(),this.$el.addClass(e)):($(document).unbind("mousemove",this.onFullscreenMouseMove),this.onFullscreenShowControls(),this.$el.removeClass(e)),this.seekBar.render(),this.trigger("sync")},onFullscreenMouseMove:function(){this.onFullscreenShowControls(),this.hideControlsTimeout=setTimeout(this.onFullscreenHideControls,3e3)},onFullscreenShowControls:function(){clearTimeout(this.hideControlsTimeout),this.$el.removeClass(f)},onFullscreenHideControls:function(){this.$el.addClass(f)},onVolumeSliderMouseDown:function(a){a.preventDefault(),$(document).bind("mousemove",this.onVolumeSliderMouseMove),$(document).bind("mouseup",this.onVolumeSliderMouseUp),$("."+l).addClass(k),this.setVolume(a.pageX)},onVolumeSliderMouseMove:function(a){a.preventDefault(),this.setVolume(a.pageX)},onVolumeSliderMouseUp:function(a){a.preventDefault(),$(document).unbind("mousemove",this.onVolumeSliderMouseMove),$(document).unbind("mouseup",this.onVolumeSliderMouseUp),$("."+l).removeClass(k),this.setVolume(a.pageX)},onPlaybackRateSliderMouseDown:function(a){a.preventDefault(),$(document).bind("mousemove",this.onPlaybackRateSliderMouseMove),$(document).bind("mouseup",this.onPlaybackRateSliderMouseUp),$("."+t).addClass(k),this.setPlaybackRate(a.pageX)},onPlaybackRateSliderMouseMove:function(a){a.preventDefault(),this.setPlaybackRate(a.pageX)},onPlaybackRateSliderMouseUp:function(a){a.preventDefault(),$(document).unbind("mousemove",this.onPlaybackRateSliderMouseMove),$(document).unbind("mouseup",this.onPlaybackRateSliderMouseUp),$("."+t).removeClass(k),this.trigger("setPlaybackRate",1)},onPausedChange:function(){var a=b.video.get("paused");a?$("."+g).removeClass(h):$("."+g).addClass(h)},onCurrentTimeChange:function(){$("."+i).html(b.video.get("formattedTime"))},onDurationChange:function(){$("."+j).html(b.video.get("formattedDuration"))},onVolumeChange:function(){var a=$("."+m),c=b.video.get("volume"),d=$("."+p).width(),e=c*d;e<4?e=4:e+4>d&&(e=d-4),$("."+q).width(e),$("."+r).css("left",e-4),c>.5?(this.muted=!1,a.removeClass(n),a.removeClass(o)):c<.5&&c>0?(this.muted=!1,a.addClass(n),a.removeClass(o)):(this.muted=!0,a.addClass(o),a.removeClass(n))},onPlaybackRateChange:function(){var a=b.video.get("playbackRate"),c=$("."+u).width(),d=a/3*c;d<4?d=4:d+4>c&&(d=c-4),$("."+v).width(d),$("."+w).css("left",d-4)}});return A})